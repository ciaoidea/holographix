version: "3.9"

services:
  holo_sender:
    build:
      context: .
      dockerfile: Dockerfile.holo
    command: >
      python3 examples/holo_mesh_sender.py
      --uri holo://demo/flower
      --chunk-dir /data/flower.jpg.holo
      --peer holo_receiver:5000
      --repeats 2
    volumes:
      - ./flower.jpg.holo:/data/flower.jpg.holo:ro
    depends_on:
      - holo_receiver

  holo_receiver:
    build:
      context: .
      dockerfile: Dockerfile.holo
    command: >
      python3 examples/holo_mesh_receiver.py
      --listen 0.0.0.0:5000
      --out-dir /data/cortex_rx
      --decode /data/recon.png
      --duration 3600
    volumes:
      - ./data:/data
    ports:
      - "5000:5000/udp"

  baseline_sender:
    build:
      context: .
      dockerfile: Dockerfile.holo
    command: >
      python3 examples/baseline_udp_sender.py
      --file /data/flower.jpg
      --peer baseline_receiver:6000
      --payload 1200
    volumes:
      - ./flower.jpg:/data/flower.jpg:ro
    depends_on:
      - baseline_receiver

  baseline_receiver:
    build:
      context: .
      dockerfile: Dockerfile.holo
    command: >
      python3 examples/baseline_udp_receiver.py
      --listen 0.0.0.0:6000
      --out /data/baseline_rx.jpg
      --duration 3600
    volumes:
      - ./data:/data
    ports:
      - "6000:6000/udp"
